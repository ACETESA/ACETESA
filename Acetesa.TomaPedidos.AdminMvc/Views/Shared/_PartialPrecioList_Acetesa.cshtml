@using System.Configuration;
@model Acetesa.TomaPedidos.AdminMvc.Models.PrecioViewModel
@if (Model != null && Model.PrecioModels != null && Model.PrecioModels.Any())
{
    <div class="well">
        <a class="btn btn-success" href="javascript:ExportarExcelPrecio('table-precios')"><i class="glyphicon glyphicon-download"></i> Excel</a>
    </div>
    <div class="col-xs-6 col-sm-10">Registros: @Model.PrecioModels.Count()</div>
    <div class="col-xs-6 col-sm-2"><b>TC</b>: @Model.TipoCambio</div>
    <table class="table table-striped table-hover" id="table-precios">
        <thead>

                    <tr>
                        <th colspan="6" scope="colgroup"></th>
                        <th colspan="2" scope="colgroup" style="background-color:#FEFEDB;">Precio 1 (Sin IGV)</th>
                        <th colspan="2" scope="colgroup" style="background-color:#EFFFDD;">Precio 2 (Sin IGV)</th>
                    </tr>


                    <tr>
                        <th scope="col">Código</th>
                        <th scope="col">Descripción</th>
                        <th scope="col">U.M.</th>
                        <th scope="col">Mon</th>
                        <th scope="col">Peso Unit</th>
                        <th scope="col">Unit x TN</th>
                        <th scope="col" style="background-color:#FEFEDB; text-align:center;">TN</th>
                        <th scope="col" style="background-color:#FEFEDB;">Unidad</th>
                        <th scope="col" style="background-color:#EFFFDD;">TN</th>
                        <th scope="col" style="background-color:#EFFFDD;">Unidad</th>
                        <th scope="col">Stock Disp.</th>
                    </tr>
        </thead>
        <tbody>
            @{
                int fila = 0;
            }
            @foreach (var item in Model.PrecioModels)
            {
                fila = fila + 1;
                var precioSoles = item.fm_valorunit;
                var precioDolares = item.fm_valorunit2;
                var nSoles = Double.Parse(precioSoles);
                var classAlertDanger = "";
            <tr class="@classAlertDanger">
                <td style="text-align:center;">@Html.DisplayFor(modelItem => item.cc_artic)</td>
                <td style="text-align:left;" title="@item.cd_artic">@Html.DisplayFor(modelItem => item.cd_artic)</td>
                <td style="text-align:center;">@Html.DisplayFor(modelItem => item.cc_unmed)</td>
                <td style="text-align:center;">@Html.DisplayFor(modelItem => item.cd_moneda)</td>
                <td style="text-align:center;">@Html.DisplayFor(modelItem => item.fq_peso_teorico)</td>
                <td style="text-align:center;">@Html.DisplayFor(modelItem => item.fq_unid_tm)</td>
                @if (fila % 2 == 0)
                {
                    <td style="text-align:center;background-color:#FEFEDB;">@Html.DisplayFor(modelItem => item.fm_valorvta_tn)</td>
                    <td style="text-align:center;background-color:#FEFEDB;">@Html.DisplayFor(modelItem => item.fm_valorunit)</td>
                    <td style="text-align:center;background-color:#EFFFDD;">@Html.DisplayFor(modelItem => item.fm_valorvta_tn2)</td>
                    <td style="text-align:center;background-color:#EFFFDD;">@Html.DisplayFor(modelItem => item.fm_valorunit2)</td>
                }
                else
                {
                    <td style="text-align:center;background-color:#F2F3C7;">@Html.DisplayFor(modelItem => item.fm_valorvta_tn)</td>
                    <td style="text-align:center;background-color:#F2F3C7;">@Html.DisplayFor(modelItem => item.fm_valorunit)</td>
                    <td style="text-align:center;background-color:#E6F7D3;">@Html.DisplayFor(modelItem => item.fm_valorvta_tn2)</td>
                    <td style="text-align:center;background-color:#E6F7D3;">@Html.DisplayFor(modelItem => item.fm_valorunit2)</td>
                }
                <td style="text-align:center;">@Html.DisplayFor(modelItem => item.ArticStk)</td>

            </tr>
            }
        </tbody>
    </table>
}
<style type="text/css">
    table thead tr th {
        text-align: center;
    }
    #table-precios tbody > tr:hover td {
        background-color: #F5F5F5 !important;
    }
</style>

@{
    try
    {
        if (Model.TipoCambio == Convert.ToDecimal(0.0000))
        {
            <script type="text/javascript">
                toastr.warning("No se ha registrado el tipo de cambio del día");
            </script>
        }
    }
    catch (Exception)
    {

    }
}

<script>
    var ListaPreciosAux = null;
    var FamiliaAux = null;
    var SubFamiliaAux = null;
    var StocksAux = null;

    function ExportarExcelPrecio() {
        var sUrl = "descargarExcelPrecio";

        $.fileDownload(sUrl, {
            httpMethod: "POST",
            data: {
                ListaPrecios: ListaPreciosAux,
                Familia: FamiliaAux,
                SubFamilia: SubFamiliaAux,
                Stocks: StocksAux,
                empresa: "Acetesa"
            },
            failMessageHtml: "There was a problem generating your report, please try again."
        });
    }
</script>